ackground:o},i)});return s(),e},endExpectedError:function(e,t){var n=c.map(function(n){d(n,e,t,!0)});return s(),n},endUnexpectedError:function(e,t){var n=c.map(function(n){d(n,e,t,!1)});return s(),n}}},this.pageVisibilityHandler=function(){document&&document.visibilityState===x?t.isPageInBackground.value=!0:t.isPageInBackground.value=!1},this.telemetrySubscribers=e||[],this.isPageInBackground=new u.m(document.visibilityState===x),document.addEventListener(O,this.pageVisibilityHandler,!1),window.addEventListener(C,this.pageVisibilityHandler,!1)}return e.prototype.unload=function(){document.removeEventListener(O,this.pageVisibilityHandler,!1),window.removeEventListener(C,this.pageVisibilityHandler,!1),this.isPageInBackground.unsubscribeAll()},e.prototype.appLogic=function(e,t){delete t.stack,this.telemetrySubscribers.forEach(function(n){n.onAppLogic(e,t)})},e.prototype.fatal=function(e,t,n){delete n.staticMessage;var a=(0,r.E0)(t);this.telemetrySubscribers.forEach(function(t){t.onFatalError(e,a,n)})},e.prototype.warn=function(e,t,n){delete n.staticMessage;var a=(0,r.E0)(t);this.telemetrySubscribers.forEach(function(t){t.onWarning(e,a,n)})},e.prototype.measureQos=function(e,t,n,a){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:r=this.startQos(e,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n()];case 2:return o=i.sent(),r.end(),[2,o];case 3:throw s=i.sent(),a&&a(s)?r.endExpectedError("Fatal",s):r.endUnexpectedError("Fatal",s),s;case 4:return[2]}})})},e.prototype.userAction=function(e,t){this.telemetrySubscribers.forEach(function(n){n.onUserAction(e,t)})},e.prototype.completedQos=function(e,t,n,a){return this.telemetrySubscribers.map(function(i){i.onCompletedQos(e,t,n,a)})},e}(),E=n(15886),A=function(){function e(e,t){this.networkErrorLogger=e,this.networkHealthCheckUrl=t}return e.prototype.getResourceLoader=function(e){var t=this.loadWithRetry.bind(this);return function(n,a,i){return e(n,function(){return t(a,i)})}},e.prototype.loadWithRetry=function(t,n){var a=this,r=this.networkErrorLogger;return function(t,n,o){return void 0===o&&(o=!0),(0,i.__awaiter)(this,void 0,void 0,function(){var n,s,c;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=o?0:3,i.label=1;case 1:if(!(n<=3))return[3,9];i.label=2;case 2:return i.trys.push([2,4,,8]),[4,t()];case 3:return[2,i.sent()];case 4:return c=i.sent(),++n>3?(s=c,[3,7]):[3,5];case 5:return[4,(l=200*Math.pow(2,n),new Promise(function(e){return setTimeout(e,l)}))];case 6:i.sent(),i.label=7;case 7:return[3,8];case 8:return[3,1];case 9:return[4,(d=s&&s.request||"",a.networkHealthCheckUrl&&e.checkFailedResource(d,a.networkHealthCheckUrl,r)||Promise.resolve())];case 10:throw i.sent(),s}var d,l})})}(t,0,n)},e.checkFailedResource=function(t,n,a){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(s){switch(s.label){case 0:r={name:"OnePlayerHealthCheck",method:"GET",url:t,isExpected:!1},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.sendRequest(n)];case 2:return s.sent(),a((0,i.__assign)((0,i.__assign)({},r),{message:(0,c.Yc)("OnePlayerHealthCheck. Can successfully reach our health URL. This means there is no client network issue, so it is a backend issue.")})),[3,4];case 3:return o=s.sent(),a((0,i.__assign)((0,i.__assign)({},r),{isExpected:!0,message:(0,c.Yc)("OnePlayerHealthCheck. Failed to reach our health URL. This means there is a client network issue"),stack:o.stack})),[3,4];case 4:return[2]}})})},e.sendRequest=function(e){if("undefined"!=typeof AbortController){var t=new AbortController,n=t.signal;return setTimeout(function(){return t.abort()},15e3),fetch(e,(0,i.__assign)({method:"GET"},{signal:n}))}var a=fetch(e,{method:"GET"}),r=new Promise(function(e,t){return setTimeout(function(){return t(new Error((0,c.Yc)("Timeout")))},15e3)});return Promise.race([a,r])},e}(),L=n(28499),k={AfterUi:!0,BeforePlayer:!0,BeforeUi:!0,BeforeMarkersUi:!0,TimeToLoad:!0,TimeToInteractive:!0,TimeToInteractionResponse:!0,TimeToStableInteractive:!0},M=function(){function e(e){this.onePlayerLogger=e,this.pluginTelemetryApis={}}return e.prototype.getTelemetryApi=function(e){return this.pluginTelemetryApis[e.pluginName]=this.pluginTelemetryApis[e.pluginName]||{appLogic:this.appLogic.bind(this,e),fatal:this.fatal.bind(this,e),userAction:this.userAction.bind(this,e),warn:this.warn.bind(this,e),measureQos:this.measureQos.bind(this,e),startQos:this.startQos.bind(this,e),networkFatal:this.networkFatal.bind(this,e),unhandledError:this.unhandledError.bind(this,e),sessionSummary:this.sessionSummary.bind(this,e),resourceTiming:this.resourceTiming.bind(this,e)},this.pluginTelemetryApis[e.pluginName]},e.prototype.appLogic=function(e,t){this.onePlayerLogger.appLogic("PluginAppLogic",(0,i.__assign)((0,i.__assign)({},e),t))},e.prototype.fatal=function(e,t,n){this.onePlayerLogger.fatal("PluginError",t,(0,i.__assign)((0,i.__assign)({},e),n))},e.prototype.networkFatal=function(e,t,n){this.onePlayerLogger.fatal("PluginNetworkError",t,(0,i.__assign)((0,i.__assign)({},e),n))},e.prototype.unhandledError=function(e,t,n){this.onePlayerLogger.fatal("PluginError",t,(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e),n),{name:"PluginErrorBoundary",isExpected:!1}))},e.prototype.warn=function(e,t,n){this.onePlayerLogger.warn("PluginError",t,(0,i.__assign)((0,i.__assign)({},e),n))},e.prototype.userAction=function(e,t){this.onePlayerLogger.userAction("PluginButtonAction",(0,i.__assign)((0,i.__assign)({},e),t))},e.prototype.applyPluginIdentifier=function(e,t){Object.assign(t,e)},e.prototype.measureQos=function(e,t,n,a){var i=this.getEventName(t.name);return this.applyPluginIdentifier(e,t),this.onePlayerLogger.measureQos(i,t,n,a)},e.prototype.startQos=function(e,t){var n=this.getEventName(t.name);return this.applyPluginIdentifier(e,t),this.onePlayerLogger.startQos(n,t)},e.prototype.sessionSummary=function(e,t){this.onePlayerLogger.appLogic("PluginSessionSummary",(0,i.__assign)((0,i.__assign)({},e),t))},e.prototype.getEventName=function(e){return k[e]?"PluginReportingEndQos":"PluginEndQos"},e.prototype.resourceTiming=function(e,t,n,a,r){var o=this;void 0===r&&(r=!1),setTimeout(function(){if(performance&&performance.getEntriesByType){var s=function(r){if(r.name.match(n)){var s=(0,L.l)(r,a),c={name:t};return o.onePlayerLogger.appLogic("PluginResourceTiming",(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e),c),s)),!0}return!1};if(r){for(var c=performance.getEntriesByType("resource"),d=c.length-1;d>=0;d--)if(s(c[d]))return}else performance.getEntriesByType("resource").forEach(function(e){s(e)})}},0)},e}(),P=function(){function e(e,t,n){var a=this;this.pluginsToLoad=e,this.playerApi=t,this.context=n,this.registry={},this.pluginUnloadHandlers=new Set,this.pluginApisCreated={},this.uniquePluginNameSet=new Set,this.phaseChangeHistory=[],this.onUiManagerSet=new y.y,this.pluginEnabledStates=new Map,this.initPhaseChange=function(e){return(0,i.__awaiter)(a,void 0,void 0,function(){var t=this;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return this.phaseChangeHistory.push(e),this.registry[e]?[4,Promise.all(this.registry[e].map(function(n){return(0,i.__awaiter)(t,void 0,void 0,function(){return(0,i.__generator)(this,function(t){return this.isPluginEnabled(n)?[2,this.ensureInstanceAndCallInitPlugin(e,n)]:[2]})})}))]:[3,2];case 1:return n.sent(),[3,2];case 2:return"AfterUi"===e&&this.logPluginsInitializedEvent(),[2]}})})},this.registerPlugin=function(e){return(0,i.__awaiter)(a,void 0,void 0,function(){var t,n,a,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(!(t=this.addToPluginRegistry(e)))return[3,4];n=0,a=this.phaseChangeHistory,i.label=1;case 1:return n<a.length?(r=a[n],e.manifest.phasesToInit.indexOf(r)>-1&&this.isPluginEnabled(t)?[4,this.ensureInstanceAndCallInitPlugin(r,t)]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},this.addToPluginRegistry=function(e){if(!a.uniquePluginNameSet.has(e.manifest.name)){a.uniquePluginNameSet.add(e.manifest.name);for(var t=void 0,n=0,i=e.manifest.phasesToInit;n<i.length;n++){var r=i[n];void 0===t&&(t={manifest:e.manifest,instanceFactory:e.instanceFactory,isEnabled:void 0===e.isEnabled?function(){return!0}:e.isEnabled}),a.registry[r]=a.registry[r]||[],a.registry[r].push(t)}return a.context.log.appLogic("PluginAppLogic",{name:"pluginRegistered",pluginName:e.manifest.name,pluginVersion:e.manifest.version}),t}a.context.log.fatal("PluginError",(0,c.Yc)("Plugin not registered because duplicate plugin already exists"),{name:"pluginRegisterFailed",isExpected:!1,pluginName:e.manifest.name,pluginVersion:e.manifest.version})},this.ensureInstanceAndCallInitPlugin=function(e,t){return(0,i.__awaiter)(a,void 0,void 0,function(){var n,a,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),n=this.logAdapter.getTelemetryApi({pluginName:t.manifest.name,pluginVersion:t.manifest.version}),void 0!==t.instance?[3,2]:(a=t,[4,t.instanceFactory(this.getResourceLoader(n),this.context.settingsStore)]);case 1:a.instance=i.sent(),i.label=2;case 2:return[4,this.initPlugin(e,t,n)];case 3:return i.sent(),t.instance.unloadHandler&&this.pluginUnloadHandlers.add(t.instance.unloadHandler),[3,5];case 4:return r=i.sent(),this.context.log.fatal("PluginError",r,{name:"pluginInitializationFailed",pluginName:t.manifest.name,pluginVersion:t.manifest.version,isExpected:!1}),[3,5];case 5:return[2]}})})},this.initPlugin=function(e,t,n){return(0,i.__awaiter)(a,void 0,void 0,function(){var a,r;return(0,i.__generator)(this,function(i){return a=this.getPluginApiAdapter({pluginName:t.manifest.name,pluginVersion:t.manifest.version},n),r={name:e},[2,a.log.measureQos(r,function(){return t.instance.phaseHandler(e,a)})]})})},this.getPluginApiAdapter=function(e,t){return a.pluginApisCreated[e.pluginName]=a.pluginApisCreated[e.pluginName]||{ui:a.getUiApiPromise(e),player:a.playerApi,localization:a.context.loc,log:t,onePlayerSettingsStore:a.context.settingsStore,settingsProviders:a.context.settingsStore.getSettingsProviders(),measuredResourceLoader:a.getResourceLoader(t),flightingContext:a.context.flightingContext},a.pluginApisCreated[e.pluginName]},this.getUiApiPromise=function(e){return a.uiManager?Promise.resolve(a.uiManager.getUiAdapter(e)):new Promise(function(t){a.onUiManagerSet.subscribe(function(n){t(n.getUiAdapter(e))})})},this.logAdapter=new M(this.context.log);for(var r=0,o=this.pluginsToLoad;r<o.length;r++){var s=o[r];this.addToPluginRegistry(s)}this.isNewPluginsInitializedSchemaEnabled=!!this.context.settingsStore.getSetting("isNewPluginsInitializedSchemaEnabled","boolean"),n.log.appLogic("PlayerAppLogic",{name:"PluginManagerCreated"})}return e.prototype.setUiManager=function(e){this.uiManager=e,this.onUiManagerSet.notify(this.uiManager)},e.prototype.unload=function(){this.pluginUnloadHandlers.forEach(function(e){return e()})},e.prototype.logPluginsInitializedEvent=function(){if(this.isNewPluginsInitializedSchemaEnabled){var e=[],t=[];this.pluginEnabledStates.forEach(function(n,a){n?e.push(a.pluginName):t.push(a.pluginName)}),this.context.log.appLogic("PluginManagerAppLogic",{name:"PluginsInitialized",pluginInitConfiguration:JSON.stringify({pluginsInitialized:e,pluginsNotInitialized:t})})}else{var n=[];this.pluginEnabledStates.forEach(function(e,t){n.push({pluginIdentifier:t,isPluginEnabled:e})}),this.context.log.appLogic("PluginManagerAppLogic",{name:"PluginsInitialized",pluginConfiguration:n})}},e.prototype.getResourceLoader=function(e){return new A(function(t){return e.networkFatal(t.staticMessage?t.staticMessage:E.G.Missing,t)},this.context.networkHealthCheckUrl||"").getResourceLoader(function(t,n){return e.measureQos({name:t},n)})},e.prototype.isPluginEnabled=function(e){var t={pluginName:e.manifest.name,pluginVersion:e.manifest.version};if(this.isNewPluginsInitializedSchemaEnabled){var n=!1,a=!1;return this.pluginEnabledStates.forEach(function(t,i){if(i.pluginName===e.manifest.name&&i.pluginVersion===e.manifest.version)return n=!0,void(a=t)}),n||(a=e.isEnabled(),this.pluginEnabledStates.set(t,a)),a}var i=this.pluginEnabledStates.get(t);return void 0===i&&(i=e.isEnabled(),this.pluginEnabledStates.set(t,i)),i},e}(),T=n(27283),U=n(16077),F=n(47111),H=n.n(F),R=!1,N=function(e,t,n,r){return(0,i.__awaiter)(void 0,void 0,void 0,function(){return(0,i.__generator)(this,function(i){switch(i.label){case 0:return"i"===n.key&&n.altKey&&!1===R?(t.log.userAction("PlayerButtonAction",{name:"OpenDiagnosticTool",playbackTimeSec:r.currentTimeInSeconds.value||-1,actionType:"KeyDown"}),R=!0,a?[3,2]:[4,B(e,t,r)]):[3,3];case 1:return i.sent(),[3,3];case 2:a.isEnabled().value=!0,i.label=3;case 3:return[2]}})})};function B(e,t,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,t.diagnosticToolProvider&&t.diagnosticToolProvider()];case 1:return(r=i.sent())?(a=r,(o=document.createElement("div")).className="diagnostic-tool",e.videoEngineContainer.appendChild(o),H().render(a.render(),o),a.isEnabled().subscribe(function(e){R=e,!1===e&&t.log.userAction("PlayerButtonAction",{name:"CloseDiagnosticTool",playbackTimeSec:n.currentTimeInSeconds.value||-1,actionType:"KeyDown"})}),[2]):[2]}})})}var j=n(10181),V=n(53361),z=function(){function e(e,t){var n=this;this.localization=e,this.context=t,this._audioFiles=new j.y([]),this.initializeAudioTracks=function(e){e&&e.subscribe(function(e){n.filterAndSortTracks(e),n._audioFiles.externalValueUpdated(e)}),n.context.log.appLogic("PluginAppLogic",{pluginName:"AudioFiles",name:"LoadedAudioTracks",pluginVersion:"",numberOfAudioFiles:void 0!==(null==e?void 0:e.value)?e.value.length:-1})},this.removeUnavailableAudioTrack=function(e){if(void 0!==e){var t=new Map(e),a=n._audioFiles.value.filter(function(e){return e.id===t.get("audioTrackId")});n._audioFiles.externalValueUpdated(a)}},this.startSwitchTrackQos=function(e,t,a){n.switchAudioTrackQos=n.context.log.startQos("PluginReportingEndQos",{name:"TimeToInteractionResponse",pluginName:"AudioFiles",pluginVersion:"",resultVariant:"SwitchAudioTrack",audioFileId:e,audioFileLanguageTag:t,isAudioDescription:a})},this.endSwitchTrackQos=function(e){var t;n.switchAudioTrackQos&&(e?null===(t=n.switchAudioTrackQos)||void 0===t||t.endUnexpectedError("Fatal",e):n.switchAudioTrackQos.end(),n.switchAudioTrackQos=void 0)},this.getAudioTrackLabel=function(e,t){var a;return a=e.isAudioDescription?t?n.localization.getString("AudioFilesMenuAudioDescriptionText"):" Audio Description":t?"":" Voice Over",(0,V.o)(e.languageTag,n.localization).concat(a)},this.filterAndSortTracks=function(e){e.filter(function(e){return null!==e.format&&"NotSupported"!==e.format&&null!==e.size&&e.size&&e.size>0}),e.sort(function(e,t){return e.languageTag&&t.languageTag?n.getAudioTrackLabel(e,!0)<n.getAudioTrackLabel(t,!0)?-1:1:0})}}return Object.defineProperty(e.prototype,"availableAudioFiles",{get:function(){return this._audioFiles},enumerable:!1,configurable:!0}),e}(),G=n(90067),K=n(66394),W=n(99035),q=function(){function e(e,t,n){var a=this;this.localization=e,this.context=t,this.getVideoElement=n,this._textTracks=new j.y([]),this._activeTextTrack=new j.y(void 0),this.isMultipleTranscriptsEnabled=!1,this.activeOffset=!1,this.minActiveVerticalPosition=80,this.minPositionPercent=1,this._currentTimeInSeconds=-1,this.isPictureInPictureActive=!1,this.trackKind="subtitles",this.isDraggableCaptionsEnabled=!1,this.analyticsWereEnabled=!1,this.turnOffTrackLabel="off",this.isFocusOnCaptions=!1,this.trustedTypesEnabledKillSwitch=!1,this.activeElement=document.activeElement,this.captionsMovedWithAnalytics=!1,this.initializeClosedCaptions=function(e){return(0,i.__awaiter)(a,void 0,void 0,function(){var t,n,a,o,s,c,d=this;return(0,i.__generator)(this,function(i){try{return this.closedCaptionsRenderQos=this.context.log.startQos("PlayerRenderEndQos",{name:"renderClosedCaptions"}),this.isMultipleTranscriptsEnabled=!!this.context.settingsStore.getSetting("isMultipleTranscriptsEnabled","boolean"),this._textTracks.value=[],this.removeVideoTracks(),this.captionsRegion||this.createCustomCaptionsRenderer(),this.isMultipleTranscriptsEnabled&&Array.isArray(e)?(a=this.orderCaptionsList(e),o=[],a.forEach(function(e){(null==e?void 0:e.isVisible)&&(t=d.mapUrlToTrack(e,e.formattedLanguage),o.push(t))}),this._textTracks.externalValueUpdated(o),this._textTracks.value=o,this.closedCaptionsRenderQos.end(),[2]):((null==(n=Array.isArray(e)?e[0]:e)?void 0:n.isVisible)&&(t=this.mapUrlToTrack(n),this._textTracks.value.push(t),this._textTracks.externalValueUpdated([t])),[2])}catch(e){throw s=(0,r.E0)(e),null===(c=this.closedCaptionsRenderQos)||void 0===c||c.endUnexpectedError("Warning",s),s}return[2]})})},this.adjustCuePositionWhenActive=function(e){a.activeOffset=e,a._activeTextTrack.value&&a.setActiveTrack(a._activeTextTrack.value.label)},this.disableTextTracks=function(){var e=a.getVideoElement();Array.from(e.getElementsByTagName("track")).forEach(function(e){var t=e.track;e.default=!1,t.mode="disabled"}),a.setActiveTrack(a.turnOffTrackLabel)},this.setActiveTrack=function(e){var t,n,i,r=a.getVideoElement();(null===(t=a._activeTextTrack.value)||void 0===t?void 0:t.label)!==e&&e!==a.turnOffTrackLabel&&(a.validateCaptionsPosition(r),window.dispatchEvent(new Event("re                  